<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Quiz Application</title>
    <link rel="stylesheet" type="text/css" href="quiz.css">
</head>
<body onload="initApp()">
<div id="mainMenu" class="modal">
    <form class="modal-content animate">
        <button onclick="showQuizListWindow(true)" type="button" id="mainMenu-quiz" class="dialog-button">Викторина</button>
        <button onclick="showCreateQuizWindow()" type="button" id="mainMenu-createQuiz" class="dialog-button">Новая викторина</button>
        <button onclick="showCreateQuestion()" type="button" id="mainMenu-createQuestion" class="dialog-button">Новый вопрос</button>
        <button onclick="showLoginWindow()" type="button" id="mainMenu-login" class="dialog-button">Войти</button>
    </form>
</div>
<div id="messageWindow" class="modal">
    <span class="close" onclick="hideMessageWindow()" title="Close">&times;</span>
    <form class="modal-content animate">
        <div style="align-content: center; border: 1px solid #cccccc">
            <p id="messageWindow-text">&nbsp;</p>
        </div>
        <button onclick="hideMessageWindow()" type="button" class="dialog-button-close">Close</button>
    </form>
</div>
<div id="loginWindow" class="modal">
    <span class="close" onclick="showMainMenu()" title="Close">&times;</span>
    <form class="modal-content animate" onsubmit="return doSubmitLogin()">
        <h1>Вход</h1>
        <div class="table-row">
            <div class="table-cell" style="width: 20%">
                <div class="table-cell-content, right_label">
                    <label for="loginWindow-name">Логин:</label>
                </div>
            </div>
            <div class="table-cell" style="width: 80%">
                <div class="table-cell-content">
                    <input type="text" id="loginWindow-name">
                </div>
            </div>
        </div>
        <div class="table-row">
            <div class="table-cell" style="width: 20%">
                <div class="table-cell-content, right_label">
                    <label for="loginWindow-password">Пароль:</label>
                </div>
            </div>
            <div class="table-cell" style="width: 80%">
                <div class="table-cell-content">
                    <input type="password" id="loginWindow-password">
                </div>
            </div>
        </div>
        <button onclick="doSubmitLogin()" type="submit" class="dialog-button" id="loginWindow-submit">Войти</button>
        <button onclick="showRegisterWindow()" type="button" class="dialog-button">Регистрация</button>
    </form>
</div>
<div id="registerWindow" class="modal">
    <span class="close" onclick="showMainMenu()" title="Close">&times;</span>
    <form class="modal-content animate" onsubmit="return doSubmitRegister()">
        <h1>Регистрация</h1>
        <div class="table-row">
            <div class="table-cell" style="width: 20%">
                <div class="table-cell-content, right_label">
                    <label for="registerWindow-name">Логин:</label>
                </div>
            </div>
            <div class="table-cell" style="width: 80%">
                <div class="table-cell-content">
                    <input type="text" id="registerWindow-name">
                </div>
            </div>
        </div>
        <div class="table-row">
            <div class="table-cell" style="width: 20%">
                <div class="table-cell-content, right_label">
                    <label for="registerWindow-nickname">Никнейм:</label>
                </div>
            </div>
            <div class="table-cell" style="width: 80%">
                <div class="table-cell-content">
                    <input type="text" id="registerWindow-nickname">
                </div>
            </div>
        </div>
        <div class="table-row">
            <div class="table-cell" style="width: 20%">
                <div class="table-cell-content, right_label">
                    <label for="registerWindow-password">Пароль:</label>
                </div>
            </div>
            <div class="table-cell" style="width: 80%">
                <div class="table-cell-content">
                    <input type="password" id="registerWindow-password">
                </div>
            </div>
        </div>
        <button onclick="doSubmitRegister()" type="submit" class="dialog-button" id="registerWindow-submit">Зарегистрироваться</button>
    </form>
</div>
<div id="quizListWindow" class="modal">
    <span class="close" onclick="showMainMenu()" title="Close">&times;</span>
    <form class="modal-content animate">
        <h1>Список викторин</h1>
        <div class="table-row">
            <div class="table-cell" style="width: 20%">
                <div class="table-cell-content, right_label">
                    <label for="quizListWindow-quizName">Название:</label>
                </div>
            </div>
            <div class="table-cell" style="width: 60%">
                <div class="table-cell-content">
                    <input type="text" id="quizListWindow-quizName">
                </div>
            </div>
            <div class="table-cell" style="width: 20%">
                <div class="table-cell-content">
                    <button onclick="doSearchQuiz()" type="button" class="search-button">Поиск</button>
                </div>
            </div>
        </div>

        <div id="quizListWindow-quizList">
            <button onclick="onSelectQuiz()" type="button" value="0" class="dialog-button">Викторина 1</button>
        </div>
        <button onclick="showMainMenu()" type="button" class="dialog-button-close">Закрыть</button>
    </form>
</div>
<div id="editQuizWindow" class="modal">
    <span class="close" onclick="showQuizListWindow()" title="Close">&times;</span>
    <form class="modal-content animate" onsubmit="return doSubmitEditQuiz()">
        <h1>Редактор викторины</h1>
        <div class="table-row">
            <div class="table-cell" style="width: 30%">
                <div class="table-cell-content, right_label">
                    <label for="editQuizWindow-name">Название:</label>
                </div>
            </div>
            <div class="table-cell" style="width: 70%">
                <div class="table-cell-content,tooltip">
                    <div class="tooltip" style="width: 100%">
                        <input type="text" id="editQuizWindow-name" name="name" required>
                        <span class="tooltip-text" id="editQuizWindow-nameTooltip">Введите имя викторины</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="table-row">
            <div class="table-cell" style="width: 30%">
                <div class="table-cell-content, right_label">
                    <label for="editQuizWindow-minPlayers">Минимум игроков:</label>
                </div>
            </div>
            <div class="table-cell" style="width: 70%">
                <div class="table-cell-content">
                    <input type="number" id="editQuizWindow-minPlayers" name="minPlayers" min="0">
                </div>
            </div>
        </div>
        <div class="table-row">
            <div class="table-cell" style="width: 30%">
                <div class="table-cell-content, right_label">
                    <label for="editQuizWindow-maxPlayers">Максимум игроков:</label>
                </div>
            </div>
            <div class="table-cell" style="width: 70%">
                <div class="table-cell-content">
                    <input type="number" id="editQuizWindow-maxPlayers" name="maxPlayers" min="0">
                </div>
            </div>
        </div>
        <div class="table-row">
            <div class="table-cell" style="width: 30%">
                <div class="table-cell-content, right_label">
                    <label for="editQuizWindow-questionType">Выбор вопросов:</label>
                </div>
            </div>
            <div class="table-cell" style="width: 70%">
                <div class="table-cell-content">
                    <select id="editQuizWindow-questionType" name="questionType" required>
                        <option disabled selected value="EMPTY">Выберите тип</option>
                        <option value="QUIZ">Из списка</option>
                        <option value="SOME">Случайно</option>
                        <option value="ALL">Все вопросы</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="table-row">
            <div class="table-cell" style="width: 30%">
                <div class="table-cell-content, right_label">
                    <label for="editQuizWindow-questionsNumber">Количество вопросов:</label>
                </div>
            </div>
            <div class="table-cell" style="width: 70%">
                <div class="table-cell-content">
                    <input type="number" id="editQuizWindow-questionsNumber" name="questionsNumber" min="0">
                </div>
            </div>
        </div>
        <div class="table-row">
            <div class="table-cell" style="width: 30%">
                <div class="table-cell-content, right_label">
                    <label for="editQuizWindow-status">Статус:</label>
                </div>
            </div>
            <div class="table-cell" style="width: 70%">
                <div class="table-cell-content">
                    <select id="editQuizWindow-status" name="status" required>
                        <option value="DRAFT" selected>Черновик</option>
                        <option value="ACTIVE">Активная</option>
                        <option value="STARTED">Начата</option>
                        <option value="FINISHED">Окончена</option>
                    </select>
                </div>
            </div>
        </div>
        <button onclick="showSelectQuestionsWindow()" type="button" id="editQuizWindow-selectQuestions" class="dialog-button">Список вопросов</button>
        <button onclick="doSubmitEditQuiz()" type="button" id="editQuizWindow-submit" class="dialog-button">Сохранить</button>
        <button onclick="showQuizListWindow()" type="button" class="dialog-button-close">Закрыть</button>
    </form>
</div>
<div id="quizWindow" class="modal">
    <span class="close" onclick="showQuizListWindow()" title="Close">&times;</span>
    <form class="modal-content animate">
        <h1>Викторина</h1>
        <div id="quizWindow-view">
            <p>Название викторины</p>
            <p>Тип викторины</p>
        </div>
        <button onclick="showEditQuizWindowFromView()" type="button" id="quizWindow-edit" class="dialog-button">Редактировать</button>
        <button onclick="doRequestRegisterQuiz()" type="button" id="quizWindow-start" class="dialog-button">Старт</button>
        <button onclick="showQuizListWindow()" type="button" class="dialog-button-close">Закрыть</button>
    </form>
</div>
<div id="questionWindow" class="modal">
    <span class="close" onclick="closeQuestionWindow()" title="Close">&times;</span>
    <form class="modal-content animate">
        <div id="questionWindow-view">
            <p>
                вопрос #1
            </p>
            <button onclick="doRequestAnswer()" type="button" value="0" class="answer-button">а) неверный ответ</button>
            <button onclick="doRequestAnswer()" type="button" value="1" class="answer-button">б) верный ответ</button>
        </div>
        <button onclick="closeQuestionWindow()" type="button" class="dialog-button-close">Закрыть</button>
        <audio id="questionWindow-sound-right" preload="auto">
            <source src="/sounds/right.mp3" type="audio/mpeg">
            <source src="/sounds/right.wav" type="audio/wav">
        </audio>
        <audio id="questionWindow-sound-wrong" preload="auto">
            <source src="/sounds/wrong.mp3" type="audio/mpeg">
            <source src="/sounds/wrong.wav" type="audio/wav">
        </audio>
        <audio id="questionWindow-sound-tickTack" preload="auto" loop>
            <source src="/sounds/tick.mp3" type="audio/mpeg">
            <source src="/sounds/tick.wav" type="audio/wav">
        </audio>
    </form>
</div>
<div id="personalInfo" style="right: 100px; position: absolute;">
    <p>Гость</p>
</div>
</body>
</html>
<script type="text/javascript" src="common.js"></script>
<script type="text/javascript" src="quiz.js"></script>
<script>
    function initApp() {
        document.onkeyup = keyPressed;
        mainMenu.show();
    }

    function keyPressed(event) {
        event = !event ? window.event : event;
        if (event.code === 'Enter') {
            if (modalWindow === messageWindow) {
                messageWindow.dismiss();
            } else if (modalWindow === loginWindow) {
                loginWindow.doSubmit();
            } else if (modalWindow === registerWindow) {
                registerWindow.doSubmit();
            }
        }
    }

    function showLoginWindow() {
        loginWindow.show();
    }

    function showMainMenu() {
        mainMenu.show();
    }

    function doSubmitLogin() {
        loginWindow.doSubmit();
        return false;
    }

    function hideMessageWindow() {
        messageWindow.dismiss();
    }

    function doSubmitRegister() {
        registerWindow.doSubmit();
        return false;
    }

    function showRegisterWindow() {
        registerWindow.show();
    }

    function showQuizListWindow(reload) {
        if (reload !== undefined) {
            quizListWindow.reload = reload;
        }
        quizListWindow.show();
    }

    function doSearchQuiz() {
        quizListWindow.reload = true;
        quizListWindow.show();
    }

    function onSelectQuiz(event) {
        event = event || window.event; // IE
        let target = event.target || event.srcElement; // IE
        let quizId = Number.parseInt(target.value);
        let quiz = quizListWindow.getQuiz(quizId);

        quizWindow.setQuiz(quiz);
        quizWindow.show();
    }

    function showEditQuizWindowFromView() {
        let quiz = quizListWindow.getQuiz(quizWindow.quizId);
        editQuizWindow.setQuiz(quiz);
        editQuizWindow.show();
    }

    function doSubmitEditQuiz() {
        editQuizWindow.saveQuiz();
        return false;
    }

    function showCreateQuizWindow() {
        editQuizWindow.setNewQuiz();
        editQuizWindow.show();
    }

    function doRequestRegisterQuiz() {
        quizWindow.registerQuiz();
    }

    function closeQuestionWindow() {
        questionWindow.close();
    }

    function doRequestAnswer(event) {
        event = event || window.event; // IE
        let target = event.target || event.srcElement; // IE
        let answerId = Number.parseInt(target.value);
        questionWindow.sendAnswer(answerId);
    }
</script>